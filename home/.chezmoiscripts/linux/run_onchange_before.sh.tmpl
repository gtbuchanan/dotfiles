#!/bin/bash
APT_REPOS=()
APT_PACKAGES=(
  "bash-completion"
  "htop"
  "ripgrep"
  "socat"
  "unzip"
)
{{ if eq .osid "linux-ubuntu" }}
SNAP_PACKAGES_CLASSIC=(
  "chezmoi"
  "powershell"
)
{{ end }}
{{ if .wsl }}
#####################################
# Windows Subsystem for Linux (WSL) #
#####################################
APT_REPOS+=(
  "ppa:dotnet/backports"
  "ppa:wslutilities/wslu"
)
APT_PACKAGES+=(
  "dotnet-sdk-9.0"
  "wslu"
)
#####################################
{{ end }}
for APT_REPO in "${APT_REPOS[@]}"; do
  sudo add-apt-repository -y "$APT_REPO"
done
sudo apt update
sudo apt -y install $(printf "%s " "${APT_PACKAGES[@]}")
{{- if eq .osid "linux-ubuntu" }}
for SNAP_PACKAGE in "${SNAP_PACKAGES_CLASSIC[@]}"; do
    sudo snap install --classic "$SNAP_PACKAGE"
done
{{ end }}

# Install ble.sh
curl -L https://github.com/akinomyoga/ble.sh/releases/download/nightly/ble-nightly.tar.xz | tar -xJf - -C /tmp
bash /tmp/ble-nightly/ble.sh --install "$HOME/.local/share"
rm -Rf /tmp/ble-nightly

# Install Nerd Font
curl -fsSL https://raw.githubusercontent.com/getnf/getnf/main/install.sh | bash
getnf -i "{{ .fontpack }}"

# Install Starship
# The package doesn't seem to be available in apt on Ubuntu WSL
curl -sS https://starship.rs/install.sh | sh
